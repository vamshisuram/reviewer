const require_chunk = require('./chunk-CUT6urMc.cjs');
const __llama_flow_core = require_chunk.__toESM(require("@llama-flow/core"));

//#region src/middleware/state.ts
function createStatefulMiddleware(init) {
	return {
		getContext: __llama_flow_core.getContext,
		withState: (workflow) => {
			return {
				...workflow,
				createContext: (input) => {
					const state = init(input);
					const context = workflow.createContext();
					context.__internal__call_context.subscribe((_, next) => {
						const context$1 = (0, __llama_flow_core.getContext)();
						if (!Reflect.has(context$1, "state")) Object.defineProperty(context$1, "state", { get: () => state });
						next(_);
					});
					if (!Reflect.has(context, "state")) Object.defineProperty(context, "state", { get: () => state });
					return context;
				}
			};
		}
	};
}

//#endregion
exports.createStatefulMiddleware = createStatefulMiddleware;
//# sourceMappingURL=state.cjs.map